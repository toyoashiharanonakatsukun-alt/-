<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Markdown Viewer</title>
  <style>
/* 枠線を表示させるためのCSSを追加しますわ */
#content table {
  border-collapse: collapse; /* セルの境界線を重ねて一つの線にします */
  width: 100%; /* 表の幅を親要素に合わせます */
  margin: 1em 0; /* 上下に少し余白をとります */
}
#content th, #content td {
  border: 1px solid #ccc; /* 1ピクセルの灰色の実線で枠線を指定します */
  padding: 8px; /* セル内の文字と枠線の間に余白を作ります */
  text-align: left; /* 文字を左寄せにします */
}
#content th {
  background-color: #f2f2f2; /* 見出し行に薄い背景色をつけます */
}
</style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      }
    };
  </script>
</head>
<body>
  <div id="content">読み込み中...</div>

  <script>
    // MathJaxが数式を処理できるように、特殊な記号の処理を調整しますわ
    marked.setOptions({
        breaks: true, // 改行を有効にする設定ですわ
        gfm: true,    // GitHub Flavored Markdownを有効にする設定ですわ
        
        // --- ★ここが最も重要ですわ★ ---
        // 数式を囲む $ や $$ を、Markdownの処理から除外するフィルターですわ
        // この設定により、MathJaxが数式として認識できるようになります。
        extensions: [{
            // インライン数式 ($...$) の処理
            name: 'inlineMath',
            level: 'inline',
            start(src) { return src.indexOf('$'); },
            tokenizer(src, tokens) {
                const rule = /^\$+([^$\n]*?)\$+/; // $...$ or $$...$$
                const match = rule.exec(src);
                if (match) {
                    return {
                        type: 'inlineMath',
                        raw: match[0],
                        text: match[1].trim()
                    };
                }
            },
            renderer(token) {
                // $...$をそのままの形でHTMLに出力しますわ
                return '$' + token.text + '$';
            }
        }, {
            // ブロック数式 ($$...$$) の処理
            name: 'blockMath',
            level: 'block',
            start(src) { return src.indexOf('$$'); },
            tokenizer(src, tokens) {
                const rule = /^\$\$([^$]*?)\$\$/; // $$...$$
                const match = rule.exec(src);
                if (match) {
                    return {
                        type: 'blockMath',
                        raw: match[0],
                        text: match[1].trim()
                    };
                }
            },
            renderer(token) {
                // $$...$$をそのままの形でHTMLに出力しますわ
                return '$$' + token.text + '$$';
            }
        }]
    });
    const params = new URLSearchParams(window.location.search);
    const src = params.get('src') || 'paper1.md';

    fetch(src)
      .then(res => res.text())
      .then(md => {
        document.getElementById('content').innerHTML = marked.parse(md);
        MathJax.typeset();
      });
  </script>
</body>
</html>
